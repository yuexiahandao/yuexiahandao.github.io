
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>coffeescript学习 | Gavin&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Gavin Zhang">
    
    <meta name="description" content="CoffeeScript 是一门编译到 JavaScript 的小巧语言. 在 Java 般笨拙的外表下, JavaScript 其实有着一颗华丽的心脏. CoffeeScript 尝试用简洁的方式展示 JavaScript 优秀的部分.CoffeeScript 的指导原则是: “她仅仅是 Java">
    
    
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="yuexiahandao" />
    <meta name="twitter:title" content="coffeescript学习 | Gavin&#39;s Blog" />
      
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png##img/logo.svg" alt="Gavin&#39;s Blog" title="Gavin&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Gavin&#39;s Blog">Gavin&#39;s Blog</a></h1>
				<h2 class="blog-motto">Welcome to Gavin Zhang&#39;s personal blog!</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/tags">Tags</a></li>
					
						<li><a href="/categories">Categories</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/10/13/coffeescript学习/" title="coffeescript学习" itemprop="url">coffeescript学习</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yuexiahandao.github.com" title="Gavin Zhang">Gavin Zhang</a>
    </p>
  <p class="article-time">
    <time datetime="2014-10-13T01:13:33.000Z" itemprop="datePublished">Oct 13 2014</time>
    Updated:<time datetime="2014-10-14T13:07:24.000Z" itemprop="dateModified">Oct 14 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用法"><span class="toc-number">2.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Literate_CoffeeScript"><span class="toc-number">3.</span> <span class="toc-text">Literate CoffeeScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语言手册"><span class="toc-number">4.</span> <span class="toc-text">语言手册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#函数"><span class="toc-number">5.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对象和数组"><span class="toc-number">6.</span> <span class="toc-text">对象和数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#词法作用域和变量安全"><span class="toc-number">7.</span> <span class="toc-text">词法作用域和变量安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if,_else,_unless_和条件赋值"><span class="toc-number">8.</span> <span class="toc-text">if, else, unless 和条件赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#变参(splats)…"><span class="toc-number">9.</span> <span class="toc-text">变参(splats)…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#循环和推导式"><span class="toc-number">10.</span> <span class="toc-text">循环和推导式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Array_Slicing_and_Splicing_with_Ranges"><span class="toc-number">11.</span> <span class="toc-text">Array Slicing and Splicing with Ranges</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一切都是表达式（至少,尽可能）"><span class="toc-number">12.</span> <span class="toc-text">一切都是表达式（至少,尽可能）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#操作符和别名"><span class="toc-number">13.</span> <span class="toc-text">操作符和别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展操作符_=>_?"><span class="toc-number">14.</span> <span class="toc-text">扩展操作符 => ?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类、接口和Super"><span class="toc-number">15.</span> <span class="toc-text">类、接口和Super</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结构赋值"><span class="toc-number">16.</span> <span class="toc-text">结构赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function_binding(函数作用域上下文)"><span class="toc-number">17.</span> <span class="toc-text">Function binding(函数作用域上下文)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内嵌的JavaScript"><span class="toc-number">18.</span> <span class="toc-text">内嵌的JavaScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Switch/When/Else"><span class="toc-number">19.</span> <span class="toc-text">Switch/When/Else</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Try/Catch/Finally"><span class="toc-number">20.</span> <span class="toc-text">Try/Catch/Finally</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#链比较"><span class="toc-number">21.</span> <span class="toc-text">链比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字符串插操作，块字符串和块注释"><span class="toc-number">22.</span> <span class="toc-text">字符串插操作，块字符串和块注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#块正则表达式"><span class="toc-number">23.</span> <span class="toc-text">块正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cake,_and_Cakefiles"><span class="toc-number">24.</span> <span class="toc-text">Cake, and Cakefiles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source_Maps"><span class="toc-number">25.</span> <span class="toc-text">Source Maps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What_is_Source_Map"><span class="toc-number">25.1.</span> <span class="toc-text">What is Source Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何启用Source_map"><span class="toc-number">25.2.</span> <span class="toc-text">如何启用Source map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何生成Source_map"><span class="toc-number">25.3.</span> <span class="toc-text">如何生成Source map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source_map的格式"><span class="toc-number">25.4.</span> <span class="toc-text">Source map的格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mappings属性"><span class="toc-number">25.5.</span> <span class="toc-text">mappings属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“text/coffeescript”脚本标签"><span class="toc-number">26.</span> <span class="toc-text">“text/coffeescript”脚本标签</span></a></li></ol>
		</div>
		
		<p>CoffeeScript 是一门编译到 JavaScript 的小巧语言. 在 Java 般笨拙的外表下, JavaScript 其实有着一颗华丽的心脏. CoffeeScript 尝试用简洁的方式展示 JavaScript 优秀的部分.<br>CoffeeScript 的指导原则是: “她仅仅是 JavaScript”. 代码一一对应地编译到 JS, 不会在编译过程中进行解释. 已有的 JavaScript 类库可以无缝地和 CoffeeScript 搭配使用, 反之亦然. 编译后的代码是可读的, 且经过美化, 能在所有 JavaScript 环境中运行, 并且应该和对应手写的 JavaScript 一样快或者更快.<br>coffeescript的语法借鉴了ruby和python的语法。</p>
<p>Official Website: </p>
<ul>
<li><a href="http://coffeescript.org/" target="_blank" rel="external">http://coffeescript.org/</a> (English)</li>
<li><a href="http://coffee-script.org/" target="_blank" rel="external">http://coffee-script.org/</a> (Chinese)</li>
</ul>
<p>书籍：深入浅出Coffeescript</p>
<h2 id="安装">安装</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g coffee-script</div></pre></td></tr></table></figure>

<p>如果你希望安装 master 分支上最新的 CoffeeScript, 你可以从源码仓库 克隆 CoffeeScript, 或直接下载源码. 还有通过 npm 方式安装 master 分支最新的 CoffeeScript 编译器:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g http://github.com/jashkenas/coffee-script/tarball/master</div></pre></td></tr></table></figure>

<p>或者你想将其安装到 /usr/local, 而不用 npm 进行管理, 进入 coffee-script 目录执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> bin/cake install</div></pre></td></tr></table></figure>

<h2 id="用法">用法</h2>
<p>安装之后, 你应该可以运行 coffee 命令以执行脚本, 编译 .coffee 文件到 .js 文件, 和提供一个交互式的 REPL.  coffee 命令有下列参数:</p>
<ul>
<li>-c, —compile   编译一个 .coffee 脚本到一个同名的 .js 文件.</li>
<li>-m, —map    随 JavaScript 文件一起生成 source maps. 并且在 JavaScript 里加上 sourceMappingURL 指令.</li>
<li>-i, —interactive    启动一个交互式的 CoffeeScript 会话用来尝试一些代码片段. 等同于执行 coffee 而不加参数.</li>
<li>-o, —output [DIR]    将所有编译后的 JavaScript 文件写到指定文件夹. 与 —compile 或 —watch 搭配使用</li>
<li>-j, —join [FILE]    编译之前, 按参数传入顺序连接所有脚本到一起, 编译后写到指定的文件. 对于编译大型项目有用.</li>
<li>-w, —watch    监视文件改变, 任何文件更新时重新执行命令.</li>
<li>-p, —print    JavaScript 直接打印到 stdout 而不是写到一个文件.</li>
<li>-s, —stdio    将 CoffeeScript 传递到 STDIN 后从 STDOUT 获取 JavaScript. 对其他语言写的进程有好处. 比如: <code>cat src/cake.coffee | coffee -sc</code></li>
<li>-l, —literate    将代码作为 Literate CoffeeScript 解析. 只会在从 stdio 直接传入代码或者处理某些没有后缀的文件名需要写明这点.</li>
<li>-e, —eval    直接从命令行编译和打印一小段 CoffeeScript. 比如:<br>coffee -e “console.log num for num in [10..1]”</li>
<li>-b, —bare    编译到 JavaScript 时去掉顶层函数的包裹.</li>
<li>-t, —tokens    不对 CoffeeScript 进行解析, 仅仅进行 lex, 打印出 token stream: [IDENTIFIER square] [ASSIGN =] [PARAM_START (] …</li>
<li>-n, —nodes    不对 CoffeeScript 进行编译, 仅仅 lex 和解析, 打印 parse tree:</li>
<li>—nodejs    node 命令有一些实用的参数, 比如—debug, —debug-brk, —max-stack-size, 和 —expose-gc. 用这个参数直接把参数转发到 Node.js. 重复使用 —nodejs 来传递多个参数.</li>
</ul>
<h2 id="Literate_CoffeeScript">Literate CoffeeScript</h2>
<p>除了被作为一个普通的编程语言, CoffeeScript 也可以在 “literate” 模式下编写。 如果你以 .litcoffee 为扩展名命名你的文件, 你可以把它当作 Markdown 文件来编写 — 此文档恰好也是一份可执行的 CoffeeScript 代码, 编译器将会把所有的缩进块 (Markdown 表示源代码的方式) 视为代码, 其他部分则为注释.</p>
<h2 id="语言手册">语言手册</h2>
<p>首先, 一些基础, CoffeeScript 使用显式的空白来区分代码块. 你不需要使用分号 ; 来关闭表达式, 在一行的结尾换行就可以了(尽管分号依然可以用来把多行的表达式简写到一行里). 不需要再用花括号来 { } 包裹代码快, 在 函数, if 表达式, switch, 和 try/catch 当中使用缩进.<br>传入参数的时候, 你不需要再使用圆括号来表明函数被执行. 隐式的函数调用的作用范围一直到行尾或者一个块级表达式. </p>
<h2 id="函数">函数</h2>
<p>函数通过一组可选的圆括号包裹的参数, 一个箭头, 一个函数体来定义. 一个空的函数像是这样:  -&gt;</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">square</span> = <span class="params">(x)</span> -&gt;</span> x * x</div><div class="line"><span class="function"><span class="title">cube</span>   = <span class="params">(x)</span> -&gt;</span> square(x) * x</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> cube, square;</div><div class="line">square = <span class="function"><span class="keyword">function</span><span class="params">(x)</span> </span>{</div><div class="line">  <span class="keyword">return</span> x * x;</div><div class="line">};</div><div class="line">cube = <span class="function"><span class="keyword">function</span><span class="params">(x)</span> </span>{</div><div class="line">  <span class="keyword">return</span> square(x) * x;</div><div class="line">};</div></pre></td></tr></table></figure>

<p>一些函数函数参数会有默认值, 当传入的参数的不存在 (null 或者 undefined) 时会被使用.</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">fill</span> = <span class="params">(container, liquid = <span class="string">"coffee"</span>)</span> -&gt;</span></div><div class="line">  <span class="string">"Filling the <span class="subst">#{container}</span> with <span class="subst">#{liquid}</span>..."</span></div></pre></td></tr></table></figure>

<h2 id="对象和数组">对象和数组</h2>
<p>CoffeeScript 中对象和数组的字面量看起来很像在 JavaScript 中的写法. 如果单个属性被写在自己的一行里, 那么逗号是可以省略的. 和 YAML 类似, 对象可以用缩进替代花括号来声明.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="variable">song =</span> [<span class="string">"do"</span>, <span class="string">"re"</span>, <span class="string">"mi"</span>, <span class="string">"fa"</span>, <span class="string">"so"</span>]</div><div class="line"><span class="variable">singers =</span> {Jagger: <span class="string">"Rock"</span>, Elvis: <span class="string">"Roll"</span>}</div><div class="line"><span class="variable">bitlist =</span> [</div><div class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span></div><div class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></div><div class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></div><div class="line">]</div><div class="line"><span class="variable">kids =</span></div><div class="line">  brother:</div><div class="line">    name: <span class="string">"Max"</span></div><div class="line">    age:  <span class="number">11</span></div><div class="line">  sister:</div><div class="line">    name: <span class="string">"Ida"</span></div><div class="line">    age:  <span class="number">9</span></div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">var bitlist, kids, singers, song;</div><div class="line"><span class="variable">song =</span> [<span class="string">"do"</span>, <span class="string">"re"</span>, <span class="string">"mi"</span>, <span class="string">"fa"</span>, <span class="string">"so"</span>];</div><div class="line"><span class="variable">singers =</span> {</div><div class="line">  Jagger: <span class="string">"Rock"</span>,</div><div class="line">  Elvis: <span class="string">"Roll"</span></div><div class="line">};</div><div class="line"><span class="variable">bitlist =</span> [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>];</div><div class="line"><span class="variable">kids =</span> {</div><div class="line">  brother: {</div><div class="line">    name: <span class="string">"Max"</span>,</div><div class="line">    age: <span class="number">11</span></div><div class="line">  },</div><div class="line">  sister: {</div><div class="line">    name: <span class="string">"Ida"</span>,</div><div class="line">    age: <span class="number">9</span></div><div class="line">  }</div><div class="line">};</div></pre></td></tr></table></figure>

<p>JavaScript 里, 你不能使用不添加引号的保留字段作为属性名称, 比如 class. CoffeeScript 里作为键出现的保留字会被识别并补上引号, 所以你不用有额外的操心(比如说, 使用 jQuery 的时候).</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$(</span><span class="string">'.account'</span>).attr <span class="class"><span class="keyword">class</span>: '<span class="title">active</span>'</span></div><div class="line">log object.<span class="keyword">class</span></div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$(</span><span class="string">'.account'</span>).attr({</div><div class="line">  <span class="string">"class"</span>: <span class="string">'active'</span></div><div class="line">});</div><div class="line"><span class="keyword">log</span>(object[<span class="string">"class"</span>]);</div></pre></td></tr></table></figure>

<h2 id="词法作用域和变量安全">词法作用域和变量安全</h2>
<p>CoffeeScript 编译器会考虑所有变量, 保证每个变量都在词法域里适当地被定义 — 你永远不需要自己去写 var.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="variable">outer =</span> <span class="number">1</span></div><div class="line"><span class="variable">changeNumbers =</span> -&gt;</div><div class="line">  <span class="variable">inner =</span> -<span class="number">1</span></div><div class="line">  <span class="variable">outer =</span> <span class="number">10</span></div><div class="line"><span class="variable">inner =</span> changeNumbers()</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> changeNumbers, inner, outer;</div><div class="line">outer = <span class="number">1</span>;</div><div class="line">changeNumbers = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> inner;</div><div class="line">  inner = -<span class="number">1</span>;</div><div class="line">  <span class="keyword">return</span> outer = <span class="number">10</span>;</div><div class="line">};</div><div class="line">inner = changeNumbers();</div></pre></td></tr></table></figure>

<p>尽管要说清楚会受到文档长度限制, 函数的所有 CoffeeScript 结果都被一个匿名函数包裹: (function(){ … })(); 这层安全的封装, 加上自动生成的 var 关键字, 使得不小心污染全局命名空间很难发生.<br>如果你希望创建一个其他脚本也能使用的顶层变量, 那么将其作为赋值在 window 上, 或者在 CommonJS 里的 exports 上. 存在操作符(existential operator)可以帮你写出一个可靠的方式找到添加位置; 比如你的目标是同时满足 CommonJS 和浏览器: exports ? this</p>
<h2 id="if,_else,_unless_和条件赋值">if, else, unless 和条件赋值</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">mood =</span> greatlyImproved <span class="keyword">if</span> singing</div><div class="line"><span class="keyword">if</span> happy <span class="constant">and</span> knowsIt</div><div class="line">  clapsHands()</div><div class="line">  chaChaCha()</div><div class="line"><span class="keyword">else</span></div><div class="line">  showIt()</div><div class="line"><span class="variable">date =</span> <span class="keyword">if</span> friday <span class="keyword">then</span> sue <span class="keyword">else</span> jill</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> <span class="built_in">date</span>, mood;</div><div class="line"><span class="keyword">if</span> (singing) {</div><div class="line">  mood <span class="subst">=</span> greatlyImproved;</div><div class="line">}</div><div class="line"><span class="keyword">if</span> (happy <span class="subst">&&</span> knowsIt) {</div><div class="line">  clapsHands();</div><div class="line">  chaChaCha();</div><div class="line">} <span class="keyword">else</span> {</div><div class="line">  showIt();</div><div class="line">}</div><div class="line"><span class="built_in">date</span> <span class="subst">=</span> friday <span class="subst">?</span> sue : jill;</div></pre></td></tr></table></figure>

<h2 id="变参(splats)…">变参(splats)…</h2>
<p>使用 JavaScript 的 arguments 对象是一种处理接收不定数量个参数的函数常用办法. CoffeeScript 在函数定义和调用里提供了变参(splats) … 的语法, 让不定个数的参数使用起来更愉悦一些.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="variable">gold =</span> <span class="variable">silver =</span> <span class="variable">rest =</span> <span class="string">"unknown"</span></div><div class="line"><span class="variable">awardMedals =</span> (first, second, others...) -&gt;</div><div class="line">  <span class="variable">gold   =</span> first</div><div class="line">  <span class="variable">silver =</span> second</div><div class="line">  <span class="variable">rest   =</span> others</div><div class="line"><span class="variable">contenders =</span> [</div><div class="line">  <span class="string">"Michael Phelps"</span></div><div class="line">  <span class="string">"Liu Xiang"</span></div><div class="line">  <span class="string">"Yao Ming"</span></div><div class="line">  <span class="string">"Allyson Felix"</span></div><div class="line">  <span class="string">"Shawn Johnson"</span></div><div class="line">  <span class="string">"Roman Sebrle"</span></div><div class="line">  <span class="string">"Guo Jingjing"</span></div><div class="line">  <span class="string">"Tyson Gay"</span></div><div class="line">  <span class="string">"Asafa Powell"</span></div><div class="line">  <span class="string">"Usain Bolt"</span></div><div class="line">]</div><div class="line">awardMedals contenders...</div><div class="line">alert <span class="string">"Gold: "</span> + gold</div><div class="line">alert <span class="string">"Silver: "</span> + silver</div><div class="line">alert <span class="string">"The Field: "</span> + rest</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">var awardMedals, contenders, gold, rest, silver,</div><div class="line">  <span class="variable">__slice =</span> [].slice;</div><div class="line"><span class="variable">gold =</span> <span class="variable">silver =</span> <span class="variable">rest =</span> <span class="string">"unknown"</span>;</div><div class="line"><span class="variable">awardMedals =</span> function() {</div><div class="line">  var first, others, second;</div><div class="line">  <span class="variable">first =</span> arguments[<span class="number">0</span>], <span class="variable">second =</span> arguments[<span class="number">1</span>], <span class="variable">others =</span> <span class="number">3</span> &lt;= arguments.length ? __slice.call(arguments, <span class="number">2</span>) : [];</div><div class="line">  <span class="variable">gold =</span> first;</div><div class="line">  <span class="variable">silver =</span> second;</div><div class="line">  return <span class="variable">rest =</span> others;</div><div class="line">};</div><div class="line"><span class="variable">contenders =</span> [<span class="string">"Michael Phelps"</span>, <span class="string">"Liu Xiang"</span>, <span class="string">"Yao Ming"</span>, <span class="string">"Allyson Felix"</span>, <span class="string">"Shawn Johnson"</span>, <span class="string">"Roman Sebrle"</span>, <span class="string">"Guo Jingjing"</span>, <span class="string">"Tyson Gay"</span>, <span class="string">"Asafa Powell"</span>, <span class="string">"Usain Bolt"</span>];</div><div class="line">awardMedals.apply(<span class="constant">null</span>, contenders);</div><div class="line">alert(<span class="string">"Gold: "</span> + gold);</div><div class="line">alert(<span class="string">"Silver: "</span> + silver);</div><div class="line">alert(<span class="string">"The Field: "</span> + rest);</div></pre></td></tr></table></figure>

<h2 id="循环和推导式">循环和推导式</h2>
<p>你可以使用CoffeeScript将大多数的循环写成基于数组、对象或范围的推导式(comprehensions)。 推导式替代（编译为）for循环，并且可以使用可选的子句和数组索引值。 不同于for循环，数组的推导式是表达式，可以被返回和赋值。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 吃午饭.</span></div><div class="line">eat food <span class="keyword">for</span> food <span class="keyword">in</span> [<span class="string">'toast'</span>, <span class="string">'cheese'</span>, <span class="string">'wine'</span>]</div><div class="line"><span class="comment"># 精致的五道菜.</span></div><div class="line">courses = [<span class="string">'greens'</span>, <span class="string">'caviar'</span>, <span class="string">'truffles'</span>, <span class="string">'roast'</span>, <span class="string">'cake'</span>]</div><div class="line">menu i + <span class="number">1</span>, dish <span class="keyword">for</span> dish, i <span class="keyword">in</span> courses</div><div class="line"><span class="comment"># 注重健康的一餐.</span></div><div class="line">foods = [<span class="string">'broccoli'</span>, <span class="string">'spinach'</span>, <span class="string">'chocolate'</span>]</div><div class="line">eat food <span class="keyword">for</span> food <span class="keyword">in</span> foods <span class="keyword">when</span> food <span class="keyword">isnt</span> <span class="string">'chocolate'</span></div></pre></td></tr></table></figure>

<p>推导式可以适用于其他一些使用循环的地方，例如each/forEach, map，或者select/filter，例如： <code>shortNames = (name for name in list when name.length &lt; 5)</code><br>如果你知道循环的开始与结束，或者希望以固定的跨度迭代，你可以在范围推导式中 指定开始与结束。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">countdown = (<span class="built_in">num</span> <span class="keyword">for</span> <span class="built_in">num</span> <span class="operator">in</span> [<span class="number">10.</span><span class="number">.1</span>])</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> countdown, num;</div><div class="line">countdown = (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> _i, _results;</div><div class="line">  _results = [];</div><div class="line">  <span class="keyword">for</span> (num = _i = <span class="number">10</span>; _i &gt;= <span class="number">1</span>; num = --_i) {</div><div class="line">    _results.push(num);</div><div class="line">  }</div><div class="line">  <span class="keyword">return</span> _results;</div><div class="line">})();</div></pre></td></tr></table></figure>

<p>注意：上面的例子中我们展示了如何将推导式赋值给变量，CoffeeScript总是将 每个循环项收集到一个数组中。但是有时候以循环结尾的函数运行的目的就是 它们的副作用(side-effects)。这种情况下要注意不要意外的返回推导式的结果， 而是在函数的结尾增加一些有意义的返回值—例如true — 或 null。</p>
<p>在推导式中使用by子句，可以实现以固定跨度迭代范围值：  evens = (x for x in [0..10] by 2)</p>
<p>推导式也可以用于迭代对象中的key和value。在推导式中使用of 来取出对象中的属性，而不是数组中的值。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yearsOld = <span class="attribute">max</span>: <span class="number">10</span>, <span class="attribute">ida</span>: <span class="number">9</span>, <span class="attribute">tim</span>: <span class="number">11</span></div><div class="line">ages = <span class="keyword">for</span> child, age <span class="keyword">of</span> yearsOld</div><div class="line">  <span class="string">"<span class="subst">#{child}</span> is <span class="subst">#{age}</span>"</span></div></pre></td></tr></table></figure>

<p>如果你希望仅迭代在当前对象中定义的属性，通过hasOwnProperty检查并 避免属性是继承来的，可以这样来写：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> own <span class="keyword">key</span>, value <span class="keyword">of</span> <span class="built_in">object</span></div></pre></td></tr></table></figure>

<p>CoffeeScript仅提供了一种底层循环，即while循环。与JavaScript中的while 循环的主要区别是，在CoffeeScript中while可以作为表达式来使用， 而且可以返回一个数组，该数组包含每个迭代项的迭代结果。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">if this.studyingEconomics</span></span></div><div class="line">  buy()  while supply &gt; demand</div><div class="line">  sell() <span class="keyword">until</span> supply &gt; demand</div></pre></td></tr></table></figure>

<p>为了更好的可读性，until关键字等同于while not, loop关键字 等同于while true。<br>局部参数的传递(很好的实例):</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> list</div><div class="line">  <span class="keyword">do</span> <span class="function"><span class="params">(filename)</span> -&gt;</span></div><div class="line">    fs.readFile filename, <span class="function"><span class="params">(err, contents)</span> -&gt;</span></div><div class="line">      compile filename, contents.toString()</div></pre></td></tr></table></figure>

<h2 id="Array_Slicing_and_Splicing_with_Ranges">Array Slicing and Splicing with Ranges</h2>
<p>3..6 ==&gt;  (3, 4, 5, 6) || (3…6) ==&gt; (3, 4, 5)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">numbers =</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line"><span class="variable">start   =</span> numbers[<span class="number">0</span>..<span class="number">2</span>]</div><div class="line"><span class="variable">middle  =</span> numbers[<span class="number">3</span>...-<span class="number">2</span>]</div><div class="line"><span class="variable">end     =</span> numbers[-<span class="number">2</span>..]</div><div class="line"><span class="variable">copy    =</span> numbers[..]</div><div class="line">numbers[<span class="number">3</span>..<span class="number">6</span>] = [-<span class="number">3</span>, -<span class="number">4</span>, -<span class="number">5</span>, -<span class="number">6</span>]</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var copy, <span class="operator"><span class="keyword">end</span>, middle, numbers, <span class="keyword">start</span>;</span></div><div class="line">numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];</div><div class="line"><span class="operator"><span class="keyword">start</span> = numbers.slice(<span class="number">0</span>, <span class="number">3</span>);</span></div><div class="line">middle = numbers.slice(3, -2);</div><div class="line"><span class="operator"><span class="keyword">end</span> = numbers.slice(-<span class="number">2</span>);</span></div><div class="line">copy = numbers.slice(0);</div><div class="line">[].splice.apply(numbers, [3, 4].concat(_ref = [-3, -4, -5, -6])), _ref;</div></pre></td></tr></table></figure>

<h2 id="一切都是表达式（至少,尽可能）">一切都是表达式（至少,尽可能）</h2>
<p>方法返回的是最后执行语句的结果.你也可以使用return语句。<br>(three = 3) ==&gt; 直接转换成变量的声明。<br>关于闭包，使用（）==&gt; ()的内容作为一个闭包，执行后作为一个值返回给左边的参数！ ，传参使用[]</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 前十个全局属性(变量).</span></div><div class="line">globals = (<span class="property">name</span> <span class="keyword">for</span> <span class="property">name</span> <span class="keyword">of</span> window)[<span class="number">0.</span>.<span class="number">.10</span>]</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> globals, name;</div><div class="line">globals = ((<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> _results;</div><div class="line">  _results = [];</div><div class="line">  <span class="keyword">for</span> (name <span class="keyword">in</span> <span class="built_in">window</span>) {</div><div class="line">    _results.push(name);</div><div class="line">  }</div><div class="line">  <span class="keyword">return</span> _results;</div><div class="line">})()).slice(<span class="number">0</span>, <span class="number">10</span>);</div></pre></td></tr></table></figure>

<p>像try/catch的这类事物直接转换成方法调用:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">alert(</div><div class="line">  <span class="keyword">try</span></div><div class="line">    nonexistent / <span class="literal">undefined</span></div><div class="line">  <span class="keyword">catch</span> error</div><div class="line">    <span class="string">"And the error is ... <span class="subst">#{error}</span>"</span></div><div class="line">)</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> error;</div><div class="line">alert((<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">try</span> {</div><div class="line">    <span class="keyword">return</span> nonexistent / <span class="keyword">void</span> <span class="number">0</span>;</div><div class="line">  } <span class="keyword">catch</span> (_error) {</div><div class="line">    error = _error;</div><div class="line">    <span class="keyword">return</span> <span class="string">"And the error is ... "</span> + error;</div><div class="line">  }</div><div class="line">})());</div></pre></td></tr></table></figure>

<p>在javascript中有少数的声明不会被转换成表达式，比如break、continue和return。</p>
<h2 id="操作符和别名">操作符和别名</h2>
<table>
<thead>
<tr>
<th style="text-align:center">CoffeeScript</th>
<th style="text-align:center">JavaScript</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">is</td>
<td style="text-align:center">===</td>
</tr>
<tr>
<td style="text-align:center">isnt</td>
<td style="text-align:center">!==</td>
</tr>
<tr>
<td style="text-align:center">not</td>
<td style="text-align:center">!</td>
</tr>
<tr>
<td style="text-align:center">and</td>
<td style="text-align:center">&amp;&amp;</td>
</tr>
<tr>
<td style="text-align:center">or</td>
<td style="text-align:center"></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">true, yes, on</td>
<td style="text-align:center">true</td>
</tr>
<tr>
<td style="text-align:center">false, no, off</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:center">@, this</td>
<td style="text-align:center">this</td>
</tr>
<tr>
<td style="text-align:center">of</td>
<td style="text-align:center">in</td>
</tr>
<tr>
<td style="text-align:center">in</td>
<td style="text-align:center">no JS equivalent</td>
</tr>
<tr>
<td style="text-align:center">a ** b</td>
<td style="text-align:center">Math.pow(a, b)</td>
</tr>
<tr>
<td style="text-align:center">a // b</td>
<td style="text-align:center">Math.floor(a / b)</td>
</tr>
<tr>
<td style="text-align:center">a %% b</td>
<td style="text-align:center">(a % b + b) % b</td>
</tr>
</tbody>
</table>
<h2 id="扩展操作符_=&gt;_?">扩展操作符 =&gt; ?</h2>
<p>变量名后面加上？如果该变量是null或者是undefined，则为false，否则为true。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">solipsism =</span> <span class="constant">true</span> <span class="keyword">if</span> mind? <span class="constant">and</span> not world?</div><div class="line"><span class="variable">speed =</span> <span class="number">0</span></div><div class="line">speed ?= <span class="number">15</span></div><div class="line"><span class="variable">footprints =</span> yeti ? <span class="string">"bear"</span></div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var footprints, solipsism, speed;</div><div class="line"><span class="keyword">if</span> ((typeof mind !== <span class="string">"undefined"</span> && mind !== <span class="constant">null</span>) && (typeof <span class="variable">world =</span>== <span class="string">"undefined"</span> || <span class="variable">world =</span>== <span class="constant">null</span>)) {</div><div class="line">  <span class="variable">solipsism =</span> <span class="constant">true</span>;</div><div class="line">}</div><div class="line"><span class="variable">speed =</span> <span class="number">0</span>;</div><div class="line"><span class="keyword">if</span> (<span class="variable">speed =</span>= <span class="constant">null</span>) {</div><div class="line">  <span class="variable">speed =</span> <span class="number">15</span>;</div><div class="line">}</div><div class="line"><span class="variable">footprints =</span> typeof yeti !== <span class="string">"undefined"</span> && yeti !== <span class="constant">null</span> ? yeti : <span class="string">"bear"</span>;</div></pre></td></tr></table></figure>

<p>?()用于检查一个方法是否存在，?.用于判断字段是否为null，存在就返回否则就返回默认值0</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">zip </span>=<span class="string"> lottery.drawWinner?().address?.zipcode</span></div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> zip, _ref;</div><div class="line">zip = <span class="keyword">typeof</span> lottery.drawWinner === <span class="string">"function"</span> ? (_ref = lottery.drawWinner().address) != <span class="keyword">null</span> ? _ref.zipcode : <span class="keyword">void</span> <span class="number">0</span> : <span class="keyword">void</span> <span class="number">0</span>;</div></pre></td></tr></table></figure>

<h2 id="类、接口和Super">类、接口和Super</h2>
<p>定义一个类：class</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span></div><div class="line">  <span class="attribute">constructor</span>: <span class="function"><span class="params">(<span class="property">@name</span>)</span> -&gt;</span></div><div class="line">  <span class="attribute">move</span>: <span class="function"><span class="params">(meters)</span> -&gt;</span></div><div class="line">    alert <span class="property">@name</span> + <span class="string">" moved <span class="subst">#{meters}</span>m."</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">Animal</span></span></div><div class="line">  <span class="attribute">move</span>:<span class="function"> -&gt;</span></div><div class="line">    alert <span class="string">"Slithering..."</span></div><div class="line">    <span class="keyword">super</span> <span class="number">5</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Horse</span> <span class="keyword">extends</span> <span class="title">Animal</span></span></div><div class="line">  <span class="attribute">move</span>:<span class="function"> -&gt;</span></div><div class="line">    alert <span class="string">"Galloping..."</span></div><div class="line">    <span class="keyword">super</span> <span class="number">45</span></div><div class="line">sam = <span class="keyword">new</span> Snake <span class="string">"Sammy the Python"</span></div><div class="line">tom = <span class="keyword">new</span> Horse <span class="string">"Tommy the Palomino"</span></div><div class="line">sam.move()</div><div class="line">tom.move()</div></pre></td></tr></table></figure>

<p>原型链的写入使用操作符::</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">String</span>::<span class="function"><span class="title">dasherize</span> = -&gt;</span></div><div class="line">  <span class="keyword">this</span>.replace <span class="regexp">/_/g</span>, <span class="string">"-"</span></div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">String</span>.prototype.dasherize = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/_/g</span>, <span class="string">"-"</span>);</div><div class="line">};</div></pre></td></tr></table></figure>

<p>有关元编程(定义类时使用可执行的代码。)，在定义类时写入原型链使用@操作符：@property: value定义原型链上的属性；@attr ‘title’, type: ‘text’定义原型链上的函数。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span></div><div class="line">  <span class="annotation">@attr</span> <span class="symbol">'titl</span>e', <span class="keyword">type</span>: <span class="symbol">'tex</span>t'</div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a;</div><div class="line">a = (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">()</span> </span>{}</div><div class="line">  a.attr(<span class="string">'title'</span>, {</div><div class="line">    type: <span class="string">'text'</span></div><div class="line">  });</div><div class="line">  <span class="keyword">return</span> a;</div><div class="line">})();</div></pre></td></tr></table></figure>

<h2 id="结构赋值">结构赋值</h2>
<p>平行赋值:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">theBait   =</span> <span class="number">1000</span></div><div class="line"><span class="variable">theSwitch =</span> <span class="number">0</span></div><div class="line">[theBait, theSwitch] = [theSwitch, theBait]</div></pre></td></tr></table></figure>

<p>这对于返回数组的形式的函数很有用。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">weatherReport</span> = <span class="params">(location)</span> -&gt;</span></div><div class="line">  <span class="comment"># 发起一个 Ajax 请求获取天气...</span></div><div class="line">  [location, <span class="number">72</span>, <span class="string">"Mostly Sunny"</span>]</div><div class="line">[city, temp, forecast] = weatherReport <span class="string">"Berkeley, CA"</span></div></pre></td></tr></table></figure>

<p>对于多重深度的结构(数组或者对象)依然可以使用结构赋值。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">futurists =</div><div class="line">  sculptor: <span class="string">"Umberto Boccioni"</span></div><div class="line">  painter:  <span class="string">"Vladimir Burliuk"</span></div><div class="line">  poet:</div><div class="line">    <span class="property">name</span>:   <span class="string">"F.T. Marinetti"</span></div><div class="line">    address: [</div><div class="line">      <span class="string">"Via Roma 42R"</span></div><div class="line">      <span class="string">"Bellagio, Italy 22021"</span></div><div class="line">    ]</div><div class="line">{poet: {<span class="property">name</span>, address: [street, city]}} = futurists</div></pre></td></tr></table></figure>

<p>Destructuring assignment can even be combined with splats.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">tag</span> = <span class="string">"&lt;impossible&gt;"</span></div><div class="line">[<span class="keyword">open</span>, contents..., <span class="keyword">close</span>] = <span class="keyword">tag</span>.<span class="built_in">split</span>(<span class="string">""</span>)</div><div class="line">#open=<span class="string">'&lt;'</span>,<span class="keyword">close</span>=<span class="string">'&gt;'</span>,contents=<span class="string">'impossible'</span></div></pre></td></tr></table></figure>

<p>用于字符串的分割:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">text = <span class="string">"Every literary critic believes he will</span></div><div class="line">        outwit history and have the last word"</div><div class="line">[first, <span class="keyword">...</span>, last] = text.split <span class="string">" "</span></div></pre></td></tr></table></figure>

<p>结构赋值用于对象属性的赋值：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Person</div><div class="line">  <span class="function"><span class="keyword">constructor</span>:</span> (options) -&gt; </div><div class="line">    <span class="comment">{@name, @age, @height}</span> = options</div><div class="line">tim = <span class="keyword">new</span> Person age: <span class="number">4</span></div></pre></td></tr></table></figure>

<h2 id="Function_binding(函数作用域上下文)">Function binding(函数作用域上下文)</h2>
<p>使用=&gt;将父类的Binding引入子类的Binding。类比于ruby的Binding。如果使用-&gt;替代=&gt;就会使子Binding访问@variable失败！因为他会直接被翻译为this.variable，而此时的作用域中this没有父作用域中的那个属性：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">Account</span> = <span class="params">(customer, cart)</span> -&gt;</span></div><div class="line">  <span class="property">@customer</span> = customer</div><div class="line">  <span class="property">@cart</span> = cart</div><div class="line">  $<span class="function"><span class="params">(<span class="string">'.shopping_cart'</span>)</span>.<span class="title">bind</span> '<span class="title">click</span>', <span class="params">(event)</span> =&gt;</span></div><div class="line">    <span class="property">@customer</span>.purchase <span class="property">@cart</span></div></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Account;</div><div class="line">Account = <span class="function"><span class="keyword">function</span><span class="params">(customer, cart)</span> </span>{</div><div class="line">  <span class="keyword">this</span>.customer = customer;</div><div class="line">  <span class="keyword">this</span>.cart = cart;</div><div class="line">  <span class="keyword">return</span> $(<span class="string">'.shopping_cart'</span>).bind(<span class="string">'click'</span>, (<span class="function"><span class="keyword">function</span><span class="params">(_this)</span> </span>{</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>{</div><div class="line">      <span class="keyword">return</span> _this.customer.purchase(_this.cart);</div><div class="line">    };</div><div class="line">  })(<span class="keyword">this</span>));</div><div class="line">};</div></pre></td></tr></table></figure>

<h2 id="内嵌的JavaScript">内嵌的JavaScript</h2>
<p>使用反引号内嵌javascript代码。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hi = `<span class="javascript"><span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</span></div><div class="line">  <span class="keyword">return</span> [<span class="built_in">document</span>.title, <span class="string">"Hello JavaScript"</span>].join(<span class="string">": "</span>);</div><div class="line">}`</div></pre></td></tr></table></figure>

<h2 id="Switch/When/Else">Switch/When/Else</h2>
<p>coffeescript的switch语句不需要写break语句.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> day</div><div class="line">  <span class="keyword">when</span> <span class="string">"Mon"</span> <span class="keyword">then</span> go work</div><div class="line">  <span class="keyword">when</span> <span class="string">"Tue"</span> <span class="keyword">then</span> go relax</div><div class="line">  <span class="keyword">when</span> <span class="string">"Thu"</span> <span class="keyword">then</span> go iceFishing</div><div class="line">  <span class="keyword">when</span> <span class="string">"Fri"</span>, <span class="string">"Sat"</span></div><div class="line">    <span class="keyword">if</span> day <span class="keyword">is</span> bingoDay</div><div class="line">      go bingo</div><div class="line">      go dancing</div><div class="line">  <span class="keyword">when</span> <span class="string">"Sun"</span> <span class="keyword">then</span> go church</div><div class="line">  <span class="keyword">else</span> go work</div></pre></td></tr></table></figure>

<p>switch语句条件中也可以使用比较表达式。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">score = <span class="number">76</span></div><div class="line">grade = <span class="keyword">switch</span></div><div class="line">  <span class="keyword">when</span> score &lt; <span class="number">60</span> <span class="keyword">then</span> <span class="string">'F'</span></div><div class="line">  <span class="keyword">when</span> score &lt; <span class="number">70</span> <span class="keyword">then</span> <span class="string">'D'</span></div><div class="line">  <span class="keyword">when</span> score &lt; <span class="number">80</span> <span class="keyword">then</span> <span class="string">'C'</span></div><div class="line">  <span class="keyword">when</span> score &lt; <span class="number">90</span> <span class="keyword">then</span> <span class="string">'B'</span></div><div class="line">  <span class="keyword">else</span> <span class="string">'A'</span></div></pre></td></tr></table></figure>

<p>编译:<br>一个一个的比较，然后找到一个case来执行。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> grade, score;</div><div class="line">score = <span class="number">76</span>;</div><div class="line">grade = (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">switch</span> (<span class="literal">false</span>) {</div><div class="line">    <span class="keyword">case</span> !(score &lt; <span class="number">60</span>):</div><div class="line">      <span class="keyword">return</span> <span class="string">'F'</span>;</div><div class="line">    <span class="keyword">case</span> !(score &lt; <span class="number">70</span>):</div><div class="line">      <span class="keyword">return</span> <span class="string">'D'</span>;</div><div class="line">    <span class="keyword">case</span> !(score &lt; <span class="number">80</span>):</div><div class="line">      <span class="keyword">return</span> <span class="string">'C'</span>;</div><div class="line">    <span class="keyword">case</span> !(score &lt; <span class="number">90</span>):</div><div class="line">      <span class="keyword">return</span> <span class="string">'B'</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> <span class="string">'A'</span>;</div><div class="line">  }</div><div class="line">})();</div></pre></td></tr></table></figure>

<h2 id="Try/Catch/Finally">Try/Catch/Finally</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span></div><div class="line">  allHellBreaksLoose()</div><div class="line">  catsAndDogsLivingTogether()</div><div class="line"><span class="keyword">catch</span> <span class="keyword">error</span></div><div class="line">  print <span class="keyword">error</span></div><div class="line"><span class="keyword">finally</span></div><div class="line">  cleanUp()</div></pre></td></tr></table></figure>

<h2 id="链比较">链比较</h2>
<p>这是继承python的特性，判断范围。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">cholesterol =</span> <span class="number">127</span></div><div class="line"><span class="variable">healthy =</span> <span class="number">200</span> &gt; cholesterol &gt; <span class="number">60</span> //<span class="variable">healthy=</span><span class="constant">true</span></div></pre></td></tr></table></figure>

<h2 id="字符串插操作，块字符串和块注释">字符串插操作，块字符串和块注释</h2>
<p>在字符串中插入变值，可以使用#{ … }</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">author =</span> <span class="string">"Wittgenstein"</span></div><div class="line"><span class="variable">quote  =</span> <span class="string">"A picture is a fact. -- #{ author }"</span></div><div class="line"><span class="variable">sentence =</span> <span class="string">"#{ 22 / 7 } is a decent approximation of π"</span></div></pre></td></tr></table></figure>

<p>coffeescript支持字符串写在多行中，缩进被忽略。多行组成字符串时会加入一个空格，除非使用反斜线\。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mobyDick = "<span class="operator"><span class="keyword">Call</span> me Ishmael. <span class="keyword">Some</span> years ago <span class="comment">--\</span></span></div><div class="line">  never mind how long precisely <span class="comment">-- having little</span></div><div class="line">  <span class="keyword">or</span> <span class="keyword">no</span> money <span class="keyword">in</span> my purse, <span class="keyword">and</span> nothing particular</div><div class="line">  <span class="keyword">to</span> interest me <span class="keyword">on</span> shore, I thought I would sail</div><div class="line">  about a little <span class="keyword">and</span> see the watery part <span class="keyword">of</span> the</div><div class="line">  world...<span class="string">"</span></div></pre></td></tr></table></figure>

<p>使用下面的形式，可以使块字符串保持原有的格式！</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">html = <span class="string">"""</span></div><div class="line">       &lt;strong&gt;</div><div class="line">         cup of coffeescript</div><div class="line">       &lt;/strong&gt;</div><div class="line">       """</div></pre></td></tr></table></figure>

<p>以下是块注释的形式，#conetent是单行注释。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">###</span></div><div class="line">SkinnyMochaHalfCaffScript Compiler v1<span class="number">.0</span></div><div class="line">Released under the<span class="constant"> MIT </span>License</div><div class="line"><span class="preprocessor">###</span></div></pre></td></tr></table></figure>

<h2 id="块正则表达式">块正则表达式</h2>
<p>coffeescript支持块正则表达式，会忽略缩进和空格。开始和结尾使用///是块注释的形式。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">OPERATOR = <span class="comment">/// ^ (</span></div><div class="line">  ?: [-=]&gt;             <span class="preprocessor"># 函数</span></div><div class="line">   | [-+*/%&lt;&gt;&|^!?=]=  <span class="preprocessor"># 复合赋值 / 比较</span></div><div class="line">   | &gt;&gt;&gt;=?             <span class="preprocessor"># 补 0 右移</span></div><div class="line">   | ([-+:])\<span class="number">1</span>         <span class="preprocessor"># 双写</span></div><div class="line">   | ([&|&lt;&gt;])\<span class="number">2</span>=?      <span class="preprocessor"># 逻辑 / 移位</span></div><div class="line">   | \?\.              <span class="preprocessor"># soak 访问</span></div><div class="line">   | \.{<span class="number">2</span>,<span class="number">3</span>}           <span class="preprocessor"># 范围或者 splat</span></div><div class="line">) <span class="comment">///</span></div></pre></td></tr></table></figure>

<h2 id="Cake,_and_Cakefiles">Cake, and Cakefiles</h2>
<p>coffeescript提供了一个类似于make和rake的工具，称之为cake。用于编译和检测coffeescript代码的任务。任务被定义在cakefile的文件中。执行时可以使用 <code>cake [task]</code>的命令，要想查看所有的task可以直接输入 <code>cake</code> 命令。<br>任务的定义使用coffeescript来书写。所以你可以加入任意的代码。定义一个有名字，有详细说明，当任务运行时调用函数的任务.如果你的任务需要来自控制台的选项，你可以用或长或短的标志来定义这个选项并且它会在这个选项的对象中可以使用。这里就是一个任务，它使用node.js的api去重建CoffeeScript的解析器。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">fs = <span class="built_in">require</span> <span class="string">'fs'</span></div><div class="line">option <span class="string">'-o'</span>, <span class="string">'--output [DIR]'</span>, <span class="string">'directory for compiled code'</span></div><div class="line">task <span class="string">'build:parser'</span>, <span class="string">'rebuild the Jison parser'</span>, <span class="function"><span class="params">(options)</span> -&gt;</span></div><div class="line">  <span class="built_in">require</span> <span class="string">'jison'</span></div><div class="line">  code = <span class="built_in">require</span>(<span class="string">'./lib/grammar'</span>).parser.generate()</div><div class="line">  dir  = options.output <span class="keyword">or</span> <span class="string">'lib'</span></div><div class="line">  fs.writeFile <span class="string">"<span class="subst">#{dir}</span>/parser.js"</span>, code</div></pre></td></tr></table></figure>

<p>如果你要在一个任务中包含其他的任务，你可以使用invoke函数：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">invoke <span class="code">`build`</span></div></pre></td></tr></table></figure>

<p>,cake是将coffeescript函数提供给命令行的最简单方式。所以不要指望任何花哨内置。如果你需要依赖或者异步回调，最好的方式是将它们写在你的代码之中而不是在cake任务中。</p>
<h2 id="Source_Maps">Source Maps</h2>
<h3 id="What_is_Source_Map">What is Source Map</h3>
<p>Source Map是一个独立的map文件，与源码在同一个目录下.JavaScript脚本正变得越来越复杂。大部分源码（尤其是各种函数库和框架）都要经过转换，才能投入生产环境。<br>常见的源码转换，主要是以下三种情况：</p>
<ul>
<li>压缩，减小体积。比如jQuery 1.9的源码，压缩前是252KB，压缩后是32KB。</li>
<li>多个文件合并，减少HTTP请求数。</li>
<li>其他语言编译成JavaScript。最常见的例子就是CoffeeScript。</li>
</ul>
<p>这三种情况，都使得实际运行的代码不同于开发代码，除错（debug）变得困难重重。通常，JavaScript的解释器会告诉你，第几行第几列代码出错。但是，这对于转换后的代码毫无用处。举例来说，jQuery 1.9压缩后只有3行，每行3万个字符，所有内部变量都改了名字。你看着报错信息，感到毫无头绪，根本不知道它所对应的原始位置。这就是Source map想要解决的问题。<br>简单说，Source map就是一个信息文件，里面储存着位置信息。也就是说，转换后的代码的每一个位置，所对应的转换前的位置。有了它，出错的时候，除错工具将直接显示原始代码，而不是转换后的代码。这无疑给开发者带来了很大方便。目前，暂时只有Chrome浏览器支持这个功能。在Developer Tools的Setting设置中，确认选中”Enable source maps”。</p>
<h3 id="如何启用Source_map">如何启用Source map</h3>
<p>正如前文所提到的，只要在转换后的代码尾部，加上一行就可以了。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　//@ sourceMappingURL=/path/<span class="keyword">to</span>/<span class="keyword">file</span>.js.<span class="built_in">map</span></div></pre></td></tr></table></figure>

<p>map文件可以放在网络上，也可以放在本地文件系统。</p>
<h3 id="如何生成Source_map">如何生成Source map</h3>
<p>最常用的方法是使用Google的Closure编译器。生成命令的格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">java -jar compiler.jar \ </div><div class="line">　　　　--js script.js \</div><div class="line">　　　　--create_<span class="built_in">source</span>_map ./script-min.js.map \</div><div class="line">　　　　--source_map_format=V3 \</div><div class="line">　　　　--js_output_file script-min.js</div></pre></td></tr></table></figure>

<p>各个参数的意义如下：</p>
<ul>
<li>js： 转换前的代码文件</li>
<li>create_source_map： 生成的source map文件</li>
<li>source_map_format：source map的版本，目前一律采用V3。</li>
<li>js_output_file： 转换后的代码文件。</li>
</ul>
<h3 id="Source_map的格式">Source map的格式</h3>
<p>整个文件就是一个JavaScript对象，可以被解释器读取。它主要有以下几个属性：</p>
<ul>
<li>version：Source map的版本，目前为3。</li>
<li>file：转换后的文件名。</li>
<li>sourceRoot：转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空。</li>
<li>sources：转换前的文件。该项是一个数组，表示可能存在多个文件合并。</li>
<li>names：转换前的所有变量名和属性名。</li>
<li>mappings：记录位置信息的字符串，下文详细介绍。</li>
</ul>
<h3 id="mappings属性">mappings属性</h3>
<p>下面才是真正有趣的部分：两个文件的各个位置是如何一一对应的。关键就是map文件的mappings属性。这是一个很长的字符串，它分成三层。</p>
<ul>
<li>第一层是行对应，以分号（;）表示，每个分号对应转换后源码的一行。所以，第一个分号前的内容，就对应源码的第一行，以此类推。</li>
<li>第二层是位置对应，以逗号（,）表示，每个逗号对应转换后源码的一个位置。所以，第一个逗号前的内容，就对应该行源码的第一个位置，以此类推。</li>
<li>第三层是位置转换，以VLQ编码表示，代表该位置对应的转换前的源码位置。</li>
</ul>
<p>Please go to <a href="http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html" target="_blank" rel="external">this</a> website to see more information!</p>
<p>CoffeeScript 1.6.1以上支持Source Map（告知你哪段js代码对应哪段coffeescript代码）。浏览器的调试器可以使用map来显示原始的代码。在生成js代码的同时生成map文件可以在编译命令中使用-m或者—map选项。</p>
<h2 id="“text/coffeescript”脚本标签">“text/coffeescript”脚本标签</h2>
<p>coffeescript代码可以直接在浏览器中运行，首先你要下载一个解释器extras/coffee-script.js，将其也加入到页面当中，它就可以编译并运行coffeescript代码。</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/js/">js</a>
  </div>




<div class="article-share" id="share">

  
<div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a class="jiathis_button_twitter">Twitter</a>
    <a class="jiathis_button_evernote">EverNote</a>
    <a href="http://www.jiathis.com/share?uid=1501277" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
" charset="utf-8"></script>      


</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/10/13/Python基础/" title="Python基础">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Python基础</span>
</a>
</div>


<div class="next">
<a href="/2014/10/12/Node-Js-Web开发基础/"  title="Node.Js Web开发基础">
 <strong>NEXT:</strong><br/> 
 <span>Node.Js Web开发基础
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用法"><span class="toc-number">2.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Literate_CoffeeScript"><span class="toc-number">3.</span> <span class="toc-text">Literate CoffeeScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语言手册"><span class="toc-number">4.</span> <span class="toc-text">语言手册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#函数"><span class="toc-number">5.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对象和数组"><span class="toc-number">6.</span> <span class="toc-text">对象和数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#词法作用域和变量安全"><span class="toc-number">7.</span> <span class="toc-text">词法作用域和变量安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if,_else,_unless_和条件赋值"><span class="toc-number">8.</span> <span class="toc-text">if, else, unless 和条件赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#变参(splats)…"><span class="toc-number">9.</span> <span class="toc-text">变参(splats)…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#循环和推导式"><span class="toc-number">10.</span> <span class="toc-text">循环和推导式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Array_Slicing_and_Splicing_with_Ranges"><span class="toc-number">11.</span> <span class="toc-text">Array Slicing and Splicing with Ranges</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一切都是表达式（至少,尽可能）"><span class="toc-number">12.</span> <span class="toc-text">一切都是表达式（至少,尽可能）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#操作符和别名"><span class="toc-number">13.</span> <span class="toc-text">操作符和别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展操作符_=>_?"><span class="toc-number">14.</span> <span class="toc-text">扩展操作符 => ?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类、接口和Super"><span class="toc-number">15.</span> <span class="toc-text">类、接口和Super</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结构赋值"><span class="toc-number">16.</span> <span class="toc-text">结构赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function_binding(函数作用域上下文)"><span class="toc-number">17.</span> <span class="toc-text">Function binding(函数作用域上下文)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内嵌的JavaScript"><span class="toc-number">18.</span> <span class="toc-text">内嵌的JavaScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Switch/When/Else"><span class="toc-number">19.</span> <span class="toc-text">Switch/When/Else</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Try/Catch/Finally"><span class="toc-number">20.</span> <span class="toc-text">Try/Catch/Finally</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#链比较"><span class="toc-number">21.</span> <span class="toc-text">链比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字符串插操作，块字符串和块注释"><span class="toc-number">22.</span> <span class="toc-text">字符串插操作，块字符串和块注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#块正则表达式"><span class="toc-number">23.</span> <span class="toc-text">块正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cake,_and_Cakefiles"><span class="toc-number">24.</span> <span class="toc-text">Cake, and Cakefiles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source_Maps"><span class="toc-number">25.</span> <span class="toc-text">Source Maps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What_is_Source_Map"><span class="toc-number">25.1.</span> <span class="toc-text">What is Source Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何启用Source_map"><span class="toc-number">25.2.</span> <span class="toc-text">如何启用Source map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何生成Source_map"><span class="toc-number">25.3.</span> <span class="toc-text">如何生成Source map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source_map的格式"><span class="toc-number">25.4.</span> <span class="toc-text">Source map的格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mappings属性"><span class="toc-number">25.5.</span> <span class="toc-text">mappings属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“text/coffeescript”脚本标签"><span class="toc-number">26.</span> <span class="toc-text">“text/coffeescript”脚本标签</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">Archives</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">15</span></li></ul>
  </div>


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/categories/NodeJs/" title="NodeJs">NodeJs<sup>5</sup></a></li>
		
			<li><a href="/categories/git-submodule/" title="git submodule">git submodule<sup>1</sup></a></li>
		
			<li><a href="/categories/ubuntu快捷键/" title="ubuntu快捷键">ubuntu快捷键<sup>1</sup></a></li>
		
			<li><a href="/categories/useful-website/" title="useful_website">useful_website<sup>1</sup></a></li>
		
			<li><a href="/categories/zhong/" title="zhong">zhong<sup>0</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/NodeJs/" title="NodeJs">NodeJs<sup>5</sup></a></li>
		
			<li><a href="/tags/git/" title="git">git<sup>2</sup></a></li>
		
			<li><a href="/tags/js/" title="js">js<sup>1</sup></a></li>
		
			<li><a href="/tags/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		
			<li><a href="/tags/python/" title="python">python<sup>3</sup></a></li>
		
			<li><a href="/tags/ss/" title="ss">ss<sup>0</sup></a></li>
		
			<li><a href="/tags/ubuntu/" title="ubuntu">ubuntu<sup>1</sup></a></li>
		
			<li><a href="/tags/useful/" title="useful">useful<sup>1</sup></a></li>
		
		</ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/NodeJs/" style="font-size: 20.00px;">NodeJs</a><a href="/tags/git/" style="font-size: 15.00px;">git</a><a href="/tags/js/" style="font-size: 12.50px;">js</a><a href="/tags/mysql/" style="font-size: 12.50px;">mysql</a><a href="/tags/python/" style="font-size: 17.50px;">python</a><a href="/tags/ss/" style="font-size: 10.00px;">ss</a><a href="/tags/ubuntu/" style="font-size: 12.50px;">ubuntu</a><a href="/tags/useful/" style="font-size: 12.50px;">useful</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
      <li><a href="http://robbinfan.com/" target="_blank" title="Robbin's Blog">Robbin's Blog</a></li>
      <li><a href="http://www.zhengmenbb.com/" target="_blank" title="Zack's Blog">Zack's Blog</a></title>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
    </ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Welcome to Gavin Zhang&#39;s personal blog! <br/>
			Welcome visiting</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/u/2113616192" target="_blank" title="weibo"></a>
		
		
		<a href="https://twitter.com/yuexiahandao" target="_blank" title="twitter"></a>
		
		
		<a href="https://github.com/yuexiahandao" target="_blank" title="github"></a>
		
		
		<a href="https://www.facebook.com/gavinzhang" target="_blank" title="facebook"></a>
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://yuexiahandao.github.com" target="_blank" title="Gavin Zhang">Gavin Zhang</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 




<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>


  </body>
</html>
